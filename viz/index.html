<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TODO</title>
    <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }

    svg {
      border: 1px solid #eee;
      border-radius: 3px;
    }

    .state rect {
      fill: #dedede;
    }

    .state text {
      font-size: 12px;
      font-family: "Gill Sans";
      text-anchor: middle;
    }

    .state .txt-sm {
      font-size: 10px;
    }

    .state--selected rect {
      fill: #0084ff;
    }

    .state--selected text {
      fill: white;
    }
    </style>
  </head>
  <body class="center">
    <div id="viz"></div>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script>
    var mapWidth = 12,
        mapHeight = 8,
        cellSize = 55,
        margin = 4;

    var width = mapWidth * cellSize + margin,
        height = mapHeight * cellSize + margin;

    var svg = d3.select("#viz").append("svg")
        .attr("width", width)
        .attr("height", height);

    d3.json("data/map.json", function(error, data) {
        console.log(data[0])

        var state = svg.append('g')
            .attr('class', 'foreground')
            .attr('transform', 'translate(' + margin / 2 + ',' + margin / 2  + ')')
          .selectAll('.state')
            .data(data)
          .enter().append('g')
            .attr('class', 'state')
            .attr('transform', function(d) {
              return 'translate(' + d.grid.x * cellSize + ',' + (d.grid.y - 1) * cellSize + ')';
            })

        state.append('rect')
            .attr('width', cellSize - 2)
            .attr('height', cellSize - 2)
            .style('fill', 'none');

        state.append('text')
            .attr('x', cellSize / 2)
            .attr('y', cellSize / 2)
            .attr('dy', '.35em')
            .text(function(d) { return d.name_short; });

        state.append('text')
            .attr('class', 'votes')
            .attr('x', cellSize - 4)
            .attr('y', cellSize - 5)
            .text(function(d) { return d.votes; });

        state.append("svg:image")
           .attr('x', 4)
           .attr('y', 4)
           .attr('width', cellSize - 8)
           .attr('height', cellSize - 8)
           .attr("xlink:href", function(d) {
                return `img/${d.emoji.replace(/:/g, '').toLowerCase()}.png`;
            })
    });
    </script>
  </body>
</html>